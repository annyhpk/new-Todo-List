import{_ as z,d as Q,n as G,i as D,e as q,f as ee,g as te,h as N,k as V,s as re,l as ne,m as x,o as H,p as se,R as m,q as ie,v as E,w as ue,c as R,r as b,j as f,b as C}from"./index-829cd2e1.js";import{u as oe,i as I,I as ae}from"./api-efcec040.js";var ce=function(u){z(i,u);function i(n,t){var e;return e=u.call(this)||this,e.client=n,e.options=t,e.trackedProps=[],e.selectError=null,e.bindMethods(),e.setOptions(t),e}var r=i.prototype;return r.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},r.onSubscribe=function(){this.listeners.length===1&&(this.currentQuery.addObserver(this),K(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},r.onUnsubscribe=function(){this.listeners.length||this.destroy()},r.shouldFetchOnReconnect=function(){return k(this.currentQuery,this.options,this.options.refetchOnReconnect)},r.shouldFetchOnWindowFocus=function(){return k(this.currentQuery,this.options,this.options.refetchOnWindowFocus)},r.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},r.setOptions=function(t,e){var o=this.options,s=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(t),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=o.queryKey),this.updateQuery();var c=this.hasListeners();c&&W(this.currentQuery,s,this.options,o)&&this.executeFetch(),this.updateResult(e),c&&(this.currentQuery!==s||this.options.enabled!==o.enabled||this.options.staleTime!==o.staleTime)&&this.updateStaleTimeout();var a=this.computeRefetchInterval();c&&(this.currentQuery!==s||this.options.enabled!==o.enabled||a!==this.currentRefetchInterval)&&this.updateRefetchInterval(a)},r.getOptimisticResult=function(t){var e=this.client.defaultQueryObserverOptions(t),o=this.client.getQueryCache().build(this.client,e);return this.createResult(o,e)},r.getCurrentResult=function(){return this.currentResult},r.trackResult=function(t,e){var o=this,s={},c=function(l){o.trackedProps.includes(l)||o.trackedProps.push(l)};return Object.keys(t).forEach(function(a){Object.defineProperty(s,a,{configurable:!1,enumerable:!0,get:function(){return c(a),t[a]}})}),(e.useErrorBoundary||e.suspense)&&c("error"),s},r.getNextResult=function(t){var e=this;return new Promise(function(o,s){var c=e.subscribe(function(a){a.isFetching||(c(),a.isError&&(t!=null&&t.throwOnError)?s(a.error):o(a))})})},r.getCurrentQuery=function(){return this.currentQuery},r.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},r.refetch=function(t){return this.fetch(Q({},t,{meta:{refetchPage:t==null?void 0:t.refetchPage}}))},r.fetchOptimistic=function(t){var e=this,o=this.client.defaultQueryObserverOptions(t),s=this.client.getQueryCache().build(this.client,o);return s.fetch().then(function(){return e.createResult(s,o)})},r.fetch=function(t){var e=this;return this.executeFetch(t).then(function(){return e.updateResult(),e.currentResult})},r.executeFetch=function(t){this.updateQuery();var e=this.currentQuery.fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(G)),e},r.updateStaleTimeout=function(){var t=this;if(this.clearStaleTimeout(),!(D||this.currentResult.isStale||!q(this.options.staleTime))){var e=ee(this.currentResult.dataUpdatedAt,this.options.staleTime),o=e+1;this.staleTimeoutId=setTimeout(function(){t.currentResult.isStale||t.updateResult()},o)}},r.computeRefetchInterval=function(){var t;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(t=this.options.refetchInterval)!=null?t:!1},r.updateRefetchInterval=function(t){var e=this;this.clearRefetchInterval(),this.currentRefetchInterval=t,!(D||this.options.enabled===!1||!q(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(function(){(e.options.refetchIntervalInBackground||te.isFocused())&&e.executeFetch()},this.currentRefetchInterval))},r.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},r.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},r.clearStaleTimeout=function(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)},r.clearRefetchInterval=function(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)},r.createResult=function(t,e){var o=this.currentQuery,s=this.options,c=this.currentResult,a=this.currentResultState,l=this.currentResultOptions,h=t!==o,p=h?t.state:this.currentQueryInitialState,O=h?this.currentResult:this.previousQueryResult,d=t.state,S=d.dataUpdatedAt,j=d.error,L=d.errorUpdatedAt,U=d.isFetching,v=d.status,_=!1,$=!1,y;if(e.optimisticResults){var B=this.hasListeners(),X=!B&&K(t,e),Y=B&&W(t,o,e,s);(X||Y)&&(U=!0,S||(v="loading"))}if(e.keepPreviousData&&!d.dataUpdateCount&&(O!=null&&O.isSuccess)&&v!=="error")y=O.data,S=O.dataUpdatedAt,v=O.status,_=!0;else if(e.select&&typeof d.data<"u")if(c&&d.data===(a==null?void 0:a.data)&&e.select===this.selectFn)y=this.selectResult;else try{this.selectFn=e.select,y=e.select(d.data),e.structuralSharing!==!1&&(y=N(c==null?void 0:c.data,y)),this.selectResult=y,this.selectError=null}catch(T){V().error(T),this.selectError=T}else y=d.data;if(typeof e.placeholderData<"u"&&typeof y>"u"&&(v==="loading"||v==="idle")){var g;if(c!=null&&c.isPlaceholderData&&e.placeholderData===(l==null?void 0:l.placeholderData))g=c.data;else if(g=typeof e.placeholderData=="function"?e.placeholderData():e.placeholderData,e.select&&typeof g<"u")try{g=e.select(g),e.structuralSharing!==!1&&(g=N(c==null?void 0:c.data,g)),this.selectError=null}catch(T){V().error(T),this.selectError=T}typeof g<"u"&&(v="success",y=g,$=!0)}this.selectError&&(j=this.selectError,y=this.selectResult,L=Date.now(),v="error");var Z={status:v,isLoading:v==="loading",isSuccess:v==="success",isError:v==="error",isIdle:v==="idle",data:y,dataUpdatedAt:S,error:j,errorUpdatedAt:L,failureCount:d.fetchFailureCount,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>p.dataUpdateCount||d.errorUpdateCount>p.errorUpdateCount,isFetching:U,isRefetching:U&&v!=="loading",isLoadingError:v==="error"&&d.dataUpdatedAt===0,isPlaceholderData:$,isPreviousData:_,isRefetchError:v==="error"&&d.dataUpdatedAt!==0,isStale:F(t,e),refetch:this.refetch,remove:this.remove};return Z},r.shouldNotifyListeners=function(t,e){if(!e)return!0;var o=this.options,s=o.notifyOnChangeProps,c=o.notifyOnChangePropsExclusions;if(!s&&!c||s==="tracked"&&!this.trackedProps.length)return!0;var a=s==="tracked"?this.trackedProps:s;return Object.keys(t).some(function(l){var h=l,p=t[h]!==e[h],O=a==null?void 0:a.some(function(S){return S===l}),d=c==null?void 0:c.some(function(S){return S===l});return p&&!d&&(!a||O)})},r.updateResult=function(t){var e=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!re(this.currentResult,e)){var o={cache:!0};(t==null?void 0:t.listeners)!==!1&&this.shouldNotifyListeners(this.currentResult,e)&&(o.listeners=!0),this.notify(Q({},o,t))}},r.updateQuery=function(){var t=this.client.getQueryCache().build(this.client,this.options);if(t!==this.currentQuery){var e=this.currentQuery;this.currentQuery=t,this.currentQueryInitialState=t.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))}},r.onQueryUpdate=function(t){var e={};t.type==="success"?e.onSuccess=!0:t.type==="error"&&!ne(t.error)&&(e.onError=!0),this.updateResult(e),this.hasListeners()&&this.updateTimers()},r.notify=function(t){var e=this;x.batch(function(){t.onSuccess?(e.options.onSuccess==null||e.options.onSuccess(e.currentResult.data),e.options.onSettled==null||e.options.onSettled(e.currentResult.data,null)):t.onError&&(e.options.onError==null||e.options.onError(e.currentResult.error),e.options.onSettled==null||e.options.onSettled(void 0,e.currentResult.error)),t.listeners&&e.listeners.forEach(function(o){o(e.currentResult)}),t.cache&&e.client.getQueryCache().notify({query:e.currentQuery,type:"observerResultsUpdated"})})},i}(H);function le(u,i){return i.enabled!==!1&&!u.state.dataUpdatedAt&&!(u.state.status==="error"&&i.retryOnMount===!1)}function K(u,i){return le(u,i)||u.state.dataUpdatedAt>0&&k(u,i,i.refetchOnMount)}function k(u,i,r){if(i.enabled!==!1){var n=typeof r=="function"?r(u):r;return n==="always"||n!==!1&&F(u,i)}return!1}function W(u,i,r,n){return r.enabled!==!1&&(u!==i||n.enabled===!1)&&(!r.suspense||u.state.status!=="error")&&F(u,r)}function F(u,i){return u.isStaleByTime(i.staleTime)}var de=function(u){z(i,u);function i(n,t){var e;return e=u.call(this)||this,e.client=n,e.setOptions(t),e.bindMethods(),e.updateResult(),e}var r=i.prototype;return r.bindMethods=function(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)},r.setOptions=function(t){this.options=this.client.defaultMutationOptions(t)},r.onUnsubscribe=function(){if(!this.listeners.length){var t;(t=this.currentMutation)==null||t.removeObserver(this)}},r.onMutationUpdate=function(t){this.updateResult();var e={listeners:!0};t.type==="success"?e.onSuccess=!0:t.type==="error"&&(e.onError=!0),this.notify(e)},r.getCurrentResult=function(){return this.currentResult},r.reset=function(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})},r.mutate=function(t,e){return this.mutateOptions=e,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,Q({},this.options,{variables:typeof t<"u"?t:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()},r.updateResult=function(){var t=this.currentMutation?this.currentMutation.state:se(),e=Q({},t,{isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset});this.currentResult=e},r.notify=function(t){var e=this;x.batch(function(){e.mutateOptions&&(t.onSuccess?(e.mutateOptions.onSuccess==null||e.mutateOptions.onSuccess(e.currentResult.data,e.currentResult.variables,e.currentResult.context),e.mutateOptions.onSettled==null||e.mutateOptions.onSettled(e.currentResult.data,null,e.currentResult.variables,e.currentResult.context)):t.onError&&(e.mutateOptions.onError==null||e.mutateOptions.onError(e.currentResult.error,e.currentResult.variables,e.currentResult.context),e.mutateOptions.onSettled==null||e.mutateOptions.onSettled(void 0,e.currentResult.error,e.currentResult.variables,e.currentResult.context))),t.listeners&&e.listeners.forEach(function(o){o(e.currentResult)})})},i}(H);function he(){var u=!1;return{clearReset:function(){u=!1},reset:function(){u=!0},isReset:function(){return u}}}var fe=m.createContext(he()),pe=function(){return m.useContext(fe)};function J(u,i,r){return typeof i=="function"?i.apply(void 0,r):typeof i=="boolean"?i:!!u}function P(u,i,r){var n=m.useRef(!1),t=m.useState(0),e=t[1],o=ie(u,i,r),s=E(),c=m.useRef();c.current?c.current.setOptions(o):c.current=new de(s,o);var a=c.current.getCurrentResult();m.useEffect(function(){n.current=!0;var h=c.current.subscribe(x.batchCalls(function(){n.current&&e(function(p){return p+1})}));return function(){n.current=!1,h()}},[]);var l=m.useCallback(function(h,p){c.current.mutate(h,p).catch(G)},[]);if(a.error&&J(void 0,c.current.options.useErrorBoundary,[a.error]))throw a.error;return Q({},a,{mutate:l,mutateAsync:a.mutate})}function ve(u,i){var r=m.useRef(!1),n=m.useState(0),t=n[1],e=E(),o=pe(),s=e.defaultQueryObserverOptions(u);s.optimisticResults=!0,s.onError&&(s.onError=x.batchCalls(s.onError)),s.onSuccess&&(s.onSuccess=x.batchCalls(s.onSuccess)),s.onSettled&&(s.onSettled=x.batchCalls(s.onSettled)),s.suspense&&(typeof s.staleTime!="number"&&(s.staleTime=1e3),s.cacheTime===0&&(s.cacheTime=1)),(s.suspense||s.useErrorBoundary)&&(o.isReset()||(s.retryOnMount=!1));var c=m.useState(function(){return new i(e,s)}),a=c[0],l=a.getOptimisticResult(s);if(m.useEffect(function(){r.current=!0,o.clearReset();var h=a.subscribe(x.batchCalls(function(){r.current&&t(function(p){return p+1})}));return a.updateResult(),function(){r.current=!1,h()}},[o,a]),m.useEffect(function(){a.setOptions(s,{listeners:!1})},[s,a]),s.suspense&&l.isLoading)throw a.fetchOptimistic(s).then(function(h){var p=h.data;s.onSuccess==null||s.onSuccess(p),s.onSettled==null||s.onSettled(p,null)}).catch(function(h){o.clearReset(),s.onError==null||s.onError(h),s.onSettled==null||s.onSettled(void 0,h)});if(l.isError&&!o.isReset()&&!l.isFetching&&J(s.suspense,s.useErrorBoundary,[l.error,a.getCurrentQuery()]))throw l.error;return s.notifyOnChangeProps==="tracked"&&(l=a.trackResult(l,s)),l}function me(u,i,r){var n=ue(u,i,r);return ve(n,ce)}const ye=R("textarea",{target:"e1x82dtq0"})({name:"51gjk0",styles:"width:19rem;border:2px solid;border-radius:0.75rem;padding:0.2rem 0.75rem;height:3.6rem;font-size:14px"});function Re({name:u,placeholder:i},r){const[n,t]=oe("");return f(ye,{ref:r,name:u,value:n,onChange:t,placeholder:i,autoComplete:"off"})}const be=b.forwardRef(Re);class w{static getTodos(){return I.get("/todos").then(i=>{var r;return(r=i.data)==null?void 0:r.data}).catch(i=>{throw new Error(`Getting todos failed: ${i}`)})}static createTodo(i){return I.post("/todos",i).then(r=>{var n;return(n=r.data)==null?void 0:n.data}).catch(r=>{throw new Error(`Creating todos failed: ${r}`)})}static updateTodo({id:i,todoPayload:r}){return I.put(`/todos/${i}`,r).then(n=>{var t;return(t=n.data)==null?void 0:t.data}).catch(n=>{throw new Error(`Updating todos failed: ${n}`)})}static deleteTodo(i){return I.delete(`/todos/${i}`).then(r=>{var n;return(n=r.data)==null?void 0:n.data}).catch(r=>{throw new Error(`Deleting todos failed: ${r}`)})}}const ge=()=>{const u=E();return P(w.deleteTodo,{onSettled:()=>{u.invalidateQueries(["todos"])}})},Oe=()=>{const u=E();return P(w.updateTodo,{onSettled:()=>{u.invalidateQueries(["todos"])}})},Se=R("div",{target:"e1idkxux6"})({name:"1eoy87d",styles:"display:flex;justify-content:space-between"}),A=R("button",{target:"e1idkxux5"})({name:"1o23sjc",styles:"border:2px solid gray;border-radius:0.5rem;height:1.6rem"}),xe=R(A,{target:"e1idkxux4"})({name:"1ai8bui",styles:":hover{background-color:#86efac;}"}),Ce=R(A,{target:"e1idkxux3"})({name:"xsmy7q",styles:":hover{background-color:#fca5a5;}"}),M=R(A.withComponent("input",{target:"e1idkxux7"}),{target:"e1idkxux2"})({name:"ezbc4w",styles:"width:15rem;height:1.2rem"}),Te=R(M.withComponent("p",{target:"e1idkxux8"}),{target:"e1idkxux1"})({name:"1rfwmzu",styles:"font-weight:bold;margin-bottom:0.5rem;border:0"}),Qe=R("pre",{target:"e1idkxux0"})({name:"n5o1pk",styles:"border:0;overflow:hidden;text-overflow:ellipsis;width:15rem;white-space:pre-wrap;word-wrap:break-word;max-height:3.6rem"});function Ee({id:u,title:i,content:r}){const[n,t]=b.useState(!1),e=b.useRef(null),o=b.useRef(null),s=Oe(),c=ge(),a=b.useCallback(()=>{if(t(p=>!p),!n||!e.current||!o.current)return;const h={title:e.current.value,content:o.current.value};s.mutate({id:u,todoPayload:h})},[n]),l=b.useCallback(()=>{c.mutate(u)},[]);return C(Se,{children:[n?C("form",{children:[f(M,{ref:e,name:"title",type:"text",defaultValue:i}),f(M,{ref:o,name:"content",type:"text",defaultValue:r})]}):C("div",{children:[f(Te,{children:i}),f(Qe,{children:r})]}),C("div",{children:[f(xe,{type:"button",onClick:a,children:n?"✅":"⚙️"}),f(Ce,{type:"button",onClick:l,children:"🗑️"})]})]})}const Ie=b.memo(Ee),we=()=>{const u=E();return P(w.createTodo,{onSettled:()=>{u.invalidateQueries(["todos"])}})},Ue=()=>me(["todos"],w.getTodos,{suspense:!0}),ke=R("div",{target:"e1ijeroj2"})({name:"130xtx7",styles:"border:2px solid;border-radius:0.75rem;padding:1.25rem;width:18rem"}),Me=R("div",{target:"e1ijeroj1"})({name:"154rxsx",styles:"display:grid;gap:1.25rem"}),Fe=R("form",{target:"e1ijeroj0"})({name:"p2oy12",styles:"display:flex;flex-direction:column;gap:0.25rem"});function je(){const u=b.useRef(null),i=b.useRef(null),{isLoading:r,data:n}=Ue(),t=we(),e=b.useCallback(o=>{o.preventDefault(),!(!u.current||!i.current)&&(t.mutate({title:u.current.value,content:i.current.value}),t.isSuccess&&(u.current.value="",i.current.value=""))},[]);return f("main",{children:C(Me,{children:[f("h3",{children:"할 일 쓰기"}),C(Fe,{onSubmit:e,children:[f(ae,{ref:u,name:"title",type:"text",placeholder:"제목"}),f(be,{ref:i,name:"content",placeholder:"내용"}),f("button",{type:"submit",children:"글 쓰기"})]}),f("h3",{children:"할 일 목록"}),f(ke,{children:r?f("p",{children:"로딩중..."}):n.map(o=>C("div",{children:[f(Ie,{...o}),f("hr",{})]},o.id)).reverse()})]})})}export{je as default};
